<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.79.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Mysql &middot; AlexNide</title>
  <meta name="description" content="MySQL日常笔记, 包括了一些常用命令和语法. " />

  
  <link type="text/css" rel="stylesheet" href="https://embraceuu.github.io/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://embraceuu.github.io/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://embraceuu.github.io/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://embraceuu.github.io/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class="theme-base-08 ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://embraceuu.github.io/"><h1>AlexNide</h1></a>
      <p class="lead">
       这里是Nide的个人博客 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://embraceuu.github.io/">Home</a> </li>
        
      </ul>
    </nav>

    <p>&copy; 2021. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Mysql</h1>
  <time datetime=2019-03-05T00:00:00Z class="post-date">Tue, Mar 5, 2019</time>
  <h2 id="mysql">MySql</h2>
<h3 id="登录"><strong>登录</strong></h3>
<p>mysql -u username -p</p>
<h3 id="执行sql文件"><strong>执行SQL文件</strong></h3>
<p>source [path][filename]</p>
<h3 id="定向输出到文件"><strong>定向输出到文件</strong></h3>
<p>开启：pager cat &raquo; [path][filename]</p>
<p>关闭：nopager</p>
<h3 id="插入更新"><strong>插入更新</strong></h3>
<p>insert &hellip; on duplicate key update &hellip; 当没有时insert，存在时update</p>
<h3 id="时间函数"><strong>时间函数</strong></h3>
<p>now() 返回SQL执行的时间 ，不是动态的当前时间</p>
<h3 id="ibd文件"><strong>ibd文件</strong></h3>
<p>mysql中的ibd文件是数据文件和索引文件，无法直接读取</p>
<h3 id="转换数据库"><strong>转换数据库</strong></h3>
<p>use &lt;dataBase&gt;</p>
<h3 id="显示表"><strong>显示表</strong></h3>
<p>show tables</p>
<h3 id="显示指定表的表结构"><strong>显示指定表的表结构</strong></h3>
<p>desc &lt;tablename&gt;</p>
<h3 id="格式化显示"><strong>格式化显示</strong></h3>
<p>\G</p>
<h3 id="contos7-离线安装mysql"><strong>ContOS7 离线安装mysql</strong></h3>
<p><a href="https://blog.csdn.net/u012802702/article/details/68070547">安装mysql</a></p>
<h3 id="备份表结构和数据"><strong>备份表结构和数据</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysqldump <span style="color:#f92672">-</span>h<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#f92672">&lt;</span>IP<span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span>u<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#f92672">&lt;</span>name<span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span>p<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#f92672">&lt;</span>pwd<span style="color:#f92672">&gt;</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#f92672">&lt;</span>dbname<span style="color:#f92672">&gt;</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#f92672">&lt;</span>tablename<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">/</span>root<span style="color:#f92672">/</span>trdSymbols.<span style="color:#66d9ef">sql</span>
<span style="color:#75715e">--where=&#34; exchange=&#39;aaa&#39;  过滤条件
</span><span style="color:#75715e">--extented-insert=false  分成多条
</span></code></pre></div><h3 id="限制显示条数"><strong>限制显示条数</strong></h3>
<p>select &hellip; limit n   显示n条</p>
<p>select &hellip; limit m n   从m+1条后面显示n条</p>
<h3 id="generator"><strong>generator</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">--eclipse中生成：maven build ...  -&gt;  mybatis-generator:generate
</span><span style="color:#75715e">--注释乱码问题：xml文件中&lt;commentGenerator&gt;里面添加&lt;property name=&#34;javaFileEncoding&#34; value=&#34;UTF-8&#34;/&gt;  -&gt;  exlipse.ini 文件，最末尾加上 -Dfile.encoding=UTF-8
</span></code></pre></div><h3 id="隔离级别"><strong>隔离级别</strong></h3>
<p><a href="http://www.cnblogs.com/zhoujinyi/p/3437475.html">隔离级别</a></p>
<h3 id="replace-into-识别同一条记录"><strong>replace into 识别同一条记录</strong></h3>
<p><a href="https://www.cnblogs.com/c-961900940/p/6197878.html">URL</a></p>
<h3 id="设置默认值"><strong>设置默认值</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> trd_orders <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">column</span> margin <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">default</span>; (<span style="color:#960050;background-color:#1e0010">若本身存在默认值，则先删除</span>)
<span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> trd_orders <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">column</span> margin <span style="color:#66d9ef">set</span> <span style="color:#66d9ef">default</span> <span style="color:#e6db74">&#39;&#39;</span>;(<span style="color:#960050;background-color:#1e0010">若本身不存在则可以直接设定</span>)
</code></pre></div><h3 id="查看建表语句"><strong>查看建表语句</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">show</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">table_name</span>;
</code></pre></div><h3 id="更改线上数据库"><strong>更改线上数据库</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">begin</span>;

<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> trd_orders <span style="color:#66d9ef">where</span> exchange <span style="color:#f92672">&lt;&gt;</span> <span style="color:#e6db74">&#39;BITMEX&#39;</span>;

<span style="color:#66d9ef">update</span> trd_orders <span style="color:#66d9ef">set</span> SecurityType <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">where</span> exchange <span style="color:#f92672">&lt;&gt;</span> <span style="color:#e6db74">&#39;BITMEX&#39;</span>;

<span style="color:#66d9ef">commit</span>;
</code></pre></div><h3 id="插入列"><strong>插入列</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">table</span> <span style="color:#f92672">`</span>trd_symbols<span style="color:#f92672">`</span> <span style="color:#66d9ef">ADD</span> <span style="color:#f92672">`</span>position_currency<span style="color:#f92672">`</span> char(<span style="color:#ae81ff">10</span>) CHARACTER <span style="color:#66d9ef">SET</span> utf8 <span style="color:#66d9ef">COLLATE</span> utf8_unicode_ci <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;期货，持仓货币&#39;</span>;
</code></pre></div><h3 id="修改列类型"><strong>修改列类型</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">table</span> <span style="color:#f92672">&lt;</span>tablename<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">modify</span>  <span style="color:#66d9ef">column</span> <span style="color:#f92672">&lt;</span>columnname<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">type</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">comment</span><span style="color:#f92672">&gt;</span>;
<span style="color:#75715e">-- 正常，能修改字段类型、类型长度、默认值、注释
</span></code></pre></div><h3 id="修改列默认值"><strong>修改列默认值</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">column</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">default</span>; (<span style="color:#960050;background-color:#1e0010">若本身存在默认值，则先删除</span>)
<span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">column</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">set</span> <span style="color:#66d9ef">default</span> <span style="color:#960050;background-color:#1e0010">默认值</span>;(<span style="color:#960050;background-color:#1e0010">若本身不存在则可以直接设定</span>)
</code></pre></div><h3 id="增加唯一键索引"><strong>增加唯一键索引</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> trd_orders <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">index</span> <span style="color:#f92672">`</span>un_cl_order_id<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>cl_ord_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>account_id<span style="color:#f92672">`</span>) <span style="color:#66d9ef">USING</span> HASH;
</code></pre></div><h3 id="替换字符串"><strong>替换字符串</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">replace</span>(<span style="color:#66d9ef">object</span>, <span style="color:#66d9ef">search</span>,<span style="color:#66d9ef">replace</span>)
</code></pre></div><h3 id="bash执行mysql"><strong>bash执行mysql</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 通过EOF
</span><span style="color:#75715e"></span>
mysql <span style="color:#f92672">-</span>h10.<span style="color:#ae81ff">35</span>.<span style="color:#ae81ff">174</span>.<span style="color:#ae81ff">248</span> <span style="color:#f92672">-</span>uroot <span style="color:#f92672">-</span>pnextfintech<span style="color:#f92672">@</span><span style="color:#ae81ff">2018</span> tradingcenter <span style="color:#f92672">&lt;&lt;</span> EOF
  
  use tradingcenter
  
  <span style="color:#66d9ef">source</span> <span style="color:#f92672">/</span>root<span style="color:#f92672">/</span>symbolJob<span style="color:#f92672">/</span><span style="color:#66d9ef">sql</span><span style="color:#f92672">/</span>bitmex.<span style="color:#66d9ef">sql</span>;
  
  exit

EOF

<span style="color:#75715e">-- 通过 -e
</span><span style="color:#75715e"></span>
mysql <span style="color:#f92672">-</span>h<span style="color:#f92672">&lt;</span>ip<span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span>u<span style="color:#f92672">&lt;</span>username<span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span>p<span style="color:#f92672">&lt;</span>password<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span>dbname<span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span>e <span style="color:#e6db74">&#34;sql语句&#34;</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">&lt;</span>path<span style="color:#f92672">&gt;&lt;</span>filename<span style="color:#f92672">&gt;</span>

mysql <span style="color:#f92672">-</span>h10.<span style="color:#ae81ff">35</span>.<span style="color:#ae81ff">174</span>.<span style="color:#ae81ff">248</span> <span style="color:#f92672">-</span>uroot <span style="color:#f92672">-</span>pnextfintech<span style="color:#f92672">@</span><span style="color:#ae81ff">2018</span> tradingcenter <span style="color:#f92672">-</span>e <span style="color:#e6db74">&#34;select count(*) from trd_orders where strategy_id = &#39;410eacec-34f7-11e9-afbc-00ff38c49b16&#39; and created_at &gt; &#39;2019-02-25 12:00&#39; and created_at &lt; &#39;2019-02-26 12:00&#39;\G&#34;</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>sqlite
</code></pre></div><h3 id="自增序列-auto_increment"><strong>自增序列 auto_increment</strong></h3>
<p>可以在表的基本信息中查看</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> information_schema.tables <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">table_name</span> <span style="color:#f92672">=</span> <span style="color:#f92672">&lt;</span>tableName<span style="color:#f92672">&gt;</span> ;
</code></pre></div><p>如果为AUTO_INCREMENT字段明确指定了一个数值，则会出现两种情况</p>
<ol>
<li>
<p>如果插入的值与已有的编号重复，则会出现出 错信息，因为AUTO_INCREMENT数据列的值必须是唯一的</p>
</li>
<li>
<p>如果插入的值大于已编号的值，则会把该插入到数据列中，并使在下一个编号将从这个新值开始递增</p>
</li>
</ol>
<h3 id="联合索引"><strong>联合索引</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">--复合索引 &lt;emp_no, title, from_date&gt;
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">where</span> emp_no <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1&#39;</span> <span style="color:#66d9ef">and</span> title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;aaa&#39;</span> <span style="color:#66d9ef">and</span> from_date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1990&#39;</span> ;   <span style="color:#75715e">--全值匹配
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">where</span> title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;aaa&#39;</span>;   <span style="color:#75715e">--不遵循最左前缀, 不明中索引
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">where</span> emp_no <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;1&#39;</span>;  <span style="color:#75715e">--命中索引, 范围查找.
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">where</span> emp_no <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;1&#39;</span> <span style="color:#66d9ef">and</span> title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;aaa&#39;</span>;  <span style="color:#75715e">--emp_no命中索引, 但是范围查找, title不能走索引.
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">where</span> emp_no <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;1&#39;</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> title;    <span style="color:#75715e">--emp_no命中索引, 同样title不能走索引;
</span></code></pre></div><h3 id="其他数据结构"><strong>其他数据结构</strong></h3>
<p>二叉树作为索引有可能会出现单边增长的情况.  O(log2n)</p>
<p>红黑树会自平衡, 不会出现单边增长的情况. JDK1.8 的 hashmap 是用的红黑树. 数据量大的时候, 深度不可控.</p>
<p>HASH 如果是定位到某一行,通过 hash 算法计算出地址,是很快, 不满足范围查找.</p>
<h3 id="btree"><strong>BTREE</strong></h3>
<ol>
<li>
<p>度(Degree)是每个节点存储数据的最大个数</p>
</li>
<li>
<p>叶子节点具有相同的深度</p>
</li>
<li>
<p>叶子阶段的指针为空</p>
</li>
<li>
<p>叶子节点的数据从左到右顺序排列</p>
</li>
</ol>
<p>每个节点内的顺序查找实在内存中查找, 几乎可以忽略不计</p>
<p>Degree 可以设计为磁盘一次I/O读取的数据数</p>
<p>BTREE 的每个节点中除了存储键值, 还有data数据, 但是如果一行的col太多, data也会很大, 也不适合.  所以引入了BTREE的变种 B+TREE.</p>
<h3 id="btree-1"><strong>B+TREE</strong></h3>
<ol>
<li>
<p>非叶子节点不存储data, 之存储key , 在容量和表大小确定的情况下, 可以增大Degree, 减少深度, 也就减少 I/O 次数.</p>
</li>
<li>
<p>B+ TREE的Degree一般会在100以上, h一般在3-5之间.</p>
</li>
<li>
<p>叶子节点增加了顺序访问指针, 提高范围查找性能. 不用返回上层,减少了I/O操作.</p>
</li>
</ol>
<p><strong>预读</strong>: 磁盘在一次 I/O 中, 会把要读取的数据相邻的局部数据一起存入内存, 并且是页的整倍数(4K). BTREE的一个节点的大小一般一会设置为4K.新建节点的时候会直接申请一页的内存, 使得一个节点在物理上也存储在一个页里面.</p>
<h3 id="聚簇索引"><strong>聚簇索引</strong></h3>
<ol>
<li>
<p>叶子节点中将索引键值和data存放在一起.</p>
</li>
<li>
<p>会自动选择为主键.</p>
</li>
<li>
<p>非主键索引不是聚簇索引</p>
</li>
</ol>
<h3 id="存储引擎"><strong>存储引擎</strong></h3>
<ol>
<li>是表级别</li>
</ol>
<h3 id="innodb"><strong>InnoDB</strong></h3>
<ol>
<li>
<p>主键索引和非主键索引的存储结构不一样</p>
</li>
<li>
<p>数据文件本身就是索引文件, 主键聚簇索引, 内存不能全部存储一个索引文件, 所以会产生I/O, B+TREE结构可以减少I/O次数.</p>
</li>
<li>
<p>Secondary key 不是聚簇索引, 但是叶子节点会存储Primary key</p>
</li>
<li>
<p>主键推荐是整型的自增序列, 因为InnoDB的存储结构, 是B+ TREE的索引文件, 自增整型检索速度比UUID要快, 并且影响二级索引的大小</p>
</li>
</ol>
<h3 id="索引策略"><strong>索引策略</strong></h3>
<ol>
<li>
<p>索引必须是独立的列, 不能用表达式或者函数的入参.</p>
</li>
<li>
<p>遵循最左前缀原则.</p>
</li>
<li>
<p>复合索引中, 范围查找影响索引.比如like和in还有&gt;&lt;这种.</p>
</li>
</ol>
<h2 id="oracle">Oracle</h2>
<h3 id="查看表空间"><strong>查看表空间</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> tablespace_name, file_id, file_name,round(bytes<span style="color:#f92672">/</span>(<span style="color:#ae81ff">1024</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1024</span>),<span style="color:#ae81ff">0</span>) total_space <span style="color:#66d9ef">from</span> dba_data_files <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> tablespace_name;
</code></pre></div><h3 id="创建表空间"><strong>创建表空间</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> tablespace hussar2 datafile <span style="color:#e6db74">&#39;G:\hussar01.DBF&#39;</span> <span style="color:#66d9ef">size</span> <span style="color:#ae81ff">500</span>M autoextend <span style="color:#66d9ef">on</span> <span style="color:#66d9ef">next</span> <span style="color:#ae81ff">100</span>M maxsize unlimited
</code></pre></div><h3 id="删除表空间"><strong>删除表空间</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">DROP</span> TABLESPACE hussar2 <span style="color:#66d9ef">INCLUDING</span> CONTENTS <span style="color:#66d9ef">AND</span> DATAFILES;
</code></pre></div><h3 id="扩展表空间"><strong>扩展表空间</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> TABLESPACE hussar2 <span style="color:#66d9ef">add</span> DATAFILE <span style="color:#e6db74">&#39;G:\hussar02.DBF&#39;</span> <span style="color:#66d9ef">size</span> <span style="color:#ae81ff">500</span>M AUTOEXTEND <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">NEXT</span> <span style="color:#ae81ff">100</span>M MAXSIZE unlimited;
</code></pre></div><h3 id="计算100天之前的日期"><strong>计算100天之前的日期</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> to_date(<span style="color:#e6db74">&#39;2017-06-01&#39;</span>, <span style="color:#e6db74">&#39;yyyy-mm-dd&#39;</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">100</span> <span style="color:#66d9ef">as</span> time <span style="color:#66d9ef">from</span> dual;
</code></pre></div><h3 id="case-when"><strong>case when</strong></h3>
<p>在检索列中的case when列，不能在where条件中直接用，可以用with as临时表将其提出来。</p>
<h3 id="decode"><strong>decode</strong></h3>
<p>decode(条件,值1,返回值1,值2,返回值2,&hellip;值n,返回值n,缺省值)，相当于IF语句，用值和条件对比，替换成返回值。</p>
<h3 id="instr"><strong>instr</strong></h3>
<p>instr（源字符串 , 目标字符串 ,开始位置,第几次出现）</p>
<h3 id="递归查询"><strong>递归查询</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">--树节点及其子节点
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">select</span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">检索列</span><span style="color:#f92672">&gt;</span>
  <span style="color:#66d9ef">from</span>  <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">table</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">where</span> <span style="color:#f92672">&lt;</span>condition<span style="color:#f92672">&gt;</span>
  <span style="color:#66d9ef">START</span> <span style="color:#66d9ef">WITH</span>  <span style="color:#f92672">&lt;</span>root<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">CONNECT</span> <span style="color:#66d9ef">BY</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">connect</span> condition<span style="color:#f92672">&gt;</span>
  <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#f92672">&lt;</span>sort<span style="color:#f92672">&gt;</span>
</code></pre></div><p>简单说来是将一个树状结构存储在一张表里，比如一个表中存在两个字段:code，parent_code，那么通过表示每一条记录的parent是谁，就可以形成一个树状结构，用上述语法的查询可以取得这棵树的所有记录，其中:</p>
<ol>
<li>
<p>条件1 是根结点的限定语句，当然可以放宽限定条件，以取得多个根结点，实际就是多棵树。</p>
</li>
<li>
<p>条件2 是连接条件，其中用PRIOR表示上一条记录，比如 CONNECT BY PRIOR code = parent_code；就是说上一条记录的code 是本条记录的parent_code，即本记录的父亲是上一条记录。</p>
</li>
<li>
<p>条件3 是过滤条件，用于对返回的所有记录进行过滤。</p>
</li>
</ol>
<h2 id="db2">DB2</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">locate(arg1,arg2,<span style="color:#f92672">&lt;</span>pos<span style="color:#f92672">&gt;</span>)

<span style="color:#75715e">-- 查找arg2中第一次出现arg1的位置，指定pos，则从arg2的pos处开始找arg1第一次出现的位置
</span><span style="color:#75715e">-- 0:未找到arg1
</span><span style="color:#75715e">-- 1:在第一个
</span></code></pre></div><h3 id="order-by-n"><strong>order by n</strong></h3>
<p>按照第n个栏位排序</p>
<h3 id="days"><strong>days</strong></h3>
<p>比较两个日期的大小，用days()可以做比较，</p>
<h3 id="1-month--10-days"><strong>1 MONTH + 10 DAYS</strong></h3>
<p>下个月的今天的十天以后，可以直接在日期后面加上。</p>
<h3 id="not-in"><strong>NOT IN</strong></h3>
<p>对于在某个范围内的，用 in (select&hellip;) ，如果是他的余集，可以用 NOT IN (select &hellip;)，即不在这个范围内的结果集。</p>
<h3 id="in"><strong>IN</strong></h3>
<p>当用到in的时候，不得不说到从前面向后面传ID字符串来直接放在in里面，但是不能直接在字符串后面拼接“，”或者下一个ID，应该这样：id_hbzl = id_hbzl +&quot;','&quot;+ ress[&lsquo;id&rsquo;];然后在后台接受的时候，也要用'&lsquo;单引号包起来。</p>
<h3 id="重组表结构"><strong>重组表结构</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">call</span> admin_cmd(<span style="color:#e6db74">&#39;reorg table ENVIR.T_ATTACHFILE_SERVICE_XKZ_HB2&#39;</span>);
</code></pre></div><h3 id="cast"><strong>CAST</strong></h3>
<p>是一个转换格式的函数，具体用法为：cast(el as type);</p>
<h3 id="with-temptablename-as-"><strong>with &lt;temptablename&gt; as ()</strong></h3>
<p>将要查询的内容组成一个临时表，在SQL中后面的select,update,delete中用到。</p>
<p>可以重复利用，尤其像UNION ALL这种查询中，可以将重复的的查询提出来。</p>
<p>有时候，会需要一些聚合函数会碰到group by分组的情况，如果一味的left join会使得其他的表格查的很不方便。</p>
<p>后面可以定义多个临时表，用逗号分开，最后一个不用。</p>
<h3 id="问题1"><strong>问题1</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">--库中查出两个用逗号连载一块的字符串id，要显示成汉字value，但是字典表中是一对一的。
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span>   ( <span style="color:#66d9ef">SELECT</span>  
  <span style="color:#66d9ef">REPLACE</span>(<span style="color:#66d9ef">REPLACE</span>(XML2CLOB(XMLAGG(XMLELEMENT(NAME A, REMARK<span style="color:#f92672">||</span><span style="color:#e6db74">&#39;,&#39;</span>))),<span style="color:#e6db74">&#39;&lt;A&gt;&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>),<span style="color:#e6db74">&#39;&lt;/A&gt;&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)
    <span style="color:#66d9ef">FROM</span>
    PLATFORM.DICT
        <span style="color:#66d9ef">WHERE</span>
            PARENT_ID <span style="color:#66d9ef">IN</span>
                (
                  <span style="color:#66d9ef">SELECT</span>
                ID
              <span style="color:#66d9ef">FROM</span>
            PLATFORM.DICT
          <span style="color:#66d9ef">WHERE</span>
        NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;FILTER_TYPE&#39;</span>)
      <span style="color:#66d9ef">AND</span> LOCATE( <span style="color:#e6db74">&#39;&#39;&#39;&#39;</span><span style="color:#f92672">||</span>NAME<span style="color:#f92672">||</span><span style="color:#e6db74">&#39;&#39;&#39;&#39;</span> , <span style="color:#e6db74">&#39;&#39;&#39;&#39;</span><span style="color:#f92672">||</span><span style="color:#66d9ef">REPLACE</span>(GSCCJLX,<span style="color:#e6db74">&#39;,&#39;</span>,<span style="color:#e6db74">&#39;&#39;&#39;,&#39;&#39;&#39;</span>)<span style="color:#f92672">||</span><span style="color:#e6db74">&#39;&#39;&#39;&#39;</span>) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) GSCCJLX
    <span style="color:#66d9ef">FROM</span>
  ENVIR.T_ZDL_UNIT_INDVAL
</code></pre></div><h3 id="leftarglengthrightarglength"><strong>LEFT(ARG,LENGTH)、RIGHT(ARG,LENGTH)</strong></h3>
<p>返回ARG字符串的左边、右边length长度的子字符串</p>
<h3 id="nvlarg0"><strong>NVL(ARG,0)</strong></h3>
<p>返回arg，如果arg为null，返回0</p>
</div>


    </main>

    
      
    
  </body>
</html>
